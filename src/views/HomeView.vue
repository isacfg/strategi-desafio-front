<template>
  <Navbar>
    <!-- category row -->
    <div
      class="mt-16 flex flex-row flex-wrap items-center justify-between gap-12 max-lg max-lg:gap-4 max-lg:justify-around"
    >
      <CategoriaSelect
        type="apartment"
        name="Apartamento"
        @categoria-select="handleCategoriaSelect"
      />
      <CategoriaSelect type="Castle" name="Castelo" @categoria-select="handleCategoriaSelect" />
      <CategoriaSelect type="Farm" name="Rural" @categoria-select="handleCategoriaSelect" />
      <CategoriaSelect type="Campervan" name="Trailers" @categoria-select="handleCategoriaSelect" />
      <CategoriaSelect type="Hotel" name="Hotel" @categoria-select="handleCategoriaSelect" />
      <CategoriaSelect type="House" name="Casa" @categoria-select="handleCategoriaSelect" />
      <CategoriaSelect type="Tent" name="Ar livre" @categoria-select="handleCategoriaSelect" />
      <CategoriaSelect type="Tiny home" name="Kitnet" @categoria-select="handleCategoriaSelect" />
    </div>

    <!-- filter and serach -->
    <div
      class="mt-12 flex items-center justify-start gap-x-4 max-md:flex-col max-md:gap-y-4 max-md:w-full"
    >
      <!-- search -->
      <div class="form-control max-md:w-full">
        <div class="input-group max-md:w-full">
          <input
            type="text"
            placeholder="Buscar Imóvel"
            class="busca input input-bordered max-md:w-full"
          />
        </div>
      </div>
      <select
        class="select select-bordered focus:outline-none sort-by w-full max-md:w-full rounded-lg"
      >
        <option disabled selected>Ordenar por:</option>
        <option>Menor preço</option>
        <option>Maior preço</option>
      </select>

      <button
        class="btn-busca btn bg-greenish text-white font-medium max-md:w-full hover:bg-green-900"
      >
        Buscar
      </button>
    </div>

    <!-- array cards -->
    <div class="custom-grid mx-auto mt-12 w-full gap-12">
      <!-- <ImovelCard v-for="index in 9" :key="index" /> -->
      <!-- <li v-for="imovel in imoveis.imoveisList" :key="imovel.id">
        {{ imovel.nome }}
      </li> -->

      <ImovelCard v-for="imovel in imoveis" :key="imovel.id" :imovel="imovel" />
    </div>

    <!-- ver mais imoveis -->
    <div class="flex items-center justify-center mt-12">
      <button @click="verMais" class="btn rounded-lg bg-greenish text-white hover:bg-emerald-700">
        Ver mais imóveis
      </button>
    </div>
  </Navbar>
</template>

<script lang="ts">
import Navbar from '@/components/Navbar.vue'
import CategoriaSelect from '@/components/CategoriaSelect.vue'
import ImovelCard from '@/components/ImovelCard.vue'

import { useImoveisStore } from '@/stores/imoveis'

export default {
  name: 'HomeView',
  components: {
    Navbar,
    CategoriaSelect,
    ImovelCard
  },
  data() {
    return {
      imoveis: [],
      shown: 9
    }
  },

  methods: {
    verMais() {
      this.shown += 9
      this.getImoveis().then((res) => {
        this.imoveis = res
      })
    },
    handleCategoriaSelect(category: string) {
      console.log(`Categoria selecionada: ${category}`)
      this.getImoveisByCategory(category).then((res) => {
        this.imoveis = res
      })
    },
    async getImoveis() {
      let c = await useImoveisStore().getImoveisFromDB(this.shown)
      return c
    },
    async getImoveisByCategory(category: string) {
      let c = await useImoveisStore().getImoveisFromDBByCategory(category)
      return c
    }
  },

  mounted() {
    this.getImoveis().then((res) => {
      this.imoveis = res
      console.log(this.imoveis)
    })
  }
}
</script>

<style lang="scss">
/* make responsive */
.custom-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-gap: 6rem;
}

@media (max-width: 1024px) {
  .custom-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 768px) {
  .custom-grid {
    grid-template-columns: repeat(1, 1fr);
  }
}

.busca {
  border-radius: 8px !important;
}

.busca:focus {
  outline: none !important;
}

.btn-busca {
  border-radius: 8px !important;
  padding: 0.5rem 1rem;
}

.sort-by {
  max-width: 200px;
}

@media (max-width: 768px) {
  .sort-by {
    max-width: 100%;
  }
}
</style>
